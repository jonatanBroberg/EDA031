#include <iostream>
#include <string>
#include <stdexcept>
#include <cstdlib>

#include "connection.h"
#include "connectionclosedexception.h"

using namespace std;

/*
 * The client program. 
 * Arguments: host_name, port_number
 */

int main(int argc, char* argv[]) {
  /*
   * Close the program if the user don't provide the host name and port number
   */
  if(argc != 3) {
    cerr << "Usage: myclient host_name port_number" << endl;
    exit(1);
  }

  int port = -1;
  /*
   * Try to convert the provided port number from string to int
   * close the program if the port number isn't a valid one
   */
  try {
    port = stoi(argv[2]);
  }catch(exception& e) {
    cerr << "Wrong port number. " << e.what() << endl;
    exit(1);
  }

  /*
   * Create a connection. Close the program if it fails
   */
  Connection conn(argv[1], port);
  if(!conn.isConnected()) {
    cerr << "Connection attempt failed" << endl;
    exit(1);
  }
}

void errMsgExit(string errMsg, ostream& errOut) {
  errOut << errMsg << endl;
  exit(1);
}
